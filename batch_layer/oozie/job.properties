# Oozie Job Properties for Batch Layer
# This file configures the batch layer workflow and coordinator

# ============================================
# Oozie Configuration
# ============================================
oozie.wf.application.path=${nameNode}/user/${user.name}/batch_layer/oozie

# ============================================
# Resource Manager & Name Node
# ============================================
jobTracker=resourcemanager:8032
nameNode=hdfs://namenode:9000
queueName=default

# ============================================
# Spark Configuration
# ============================================
sparkMaster=yarn
sparkMode=cluster
executorMemory=4G
executorCores=2
numExecutors=3

# ============================================
# Workflow Path
# ============================================
workflowAppPath=${nameNode}/user/${user.name}/batch_layer/oozie
workflowRoot=${nameNode}/user/${user.name}/batch_layer

# ============================================
# Data Paths (MinIO S3)
# ============================================
# Input: Raw events ingested from Kafka to MinIO
inputBasePath=s3a://bucket-0/master_dataset

# Output: Precomputed batch views
outputBasePath=s3a://bucket-0/batch_views

# ============================================
# Coordinator Configuration
# ============================================
# Start time (format: YYYY-MM-DDTHH:mmZ)
startTime=2025-12-11T00:00Z

# End time (format: YYYY-MM-DDTHH:mmZ)
# Set to far future for continuous execution
endTime=2026-12-31T23:59Z

# Frequency: Run daily at midnight
# coord:hours(24) = every 24 hours
frequency=${coord:hours(24)}

# ============================================
# User & Permissions
# ============================================
user.name=${user.name}
oozie.use.system.libpath=true

# ============================================
# Additional Spark Dependencies
# ============================================
# Add MinIO/S3 dependencies
spark.jars.packages=org.apache.hadoop:hadoop-aws:3.3.1,com.amazonaws:aws-java-sdk-bundle:1.11.901

# S3A Configuration for MinIO
spark.hadoop.fs.s3a.endpoint=http://minio:9000
spark.hadoop.fs.s3a.access.key=minioadmin
spark.hadoop.fs.s3a.secret.key=minioadmin
spark.hadoop.fs.s3a.path.style.access=true
spark.hadoop.fs.s3a.impl=org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled=false

# ============================================
# Notification Configuration (Optional)
# ============================================
# Email notifications on workflow completion/failure
# oozie.email.smtp.host=smtp.gmail.com
# oozie.email.smtp.port=587
# oozie.email.from.address=oozie@example.com
# oozie.wf.workflow.notification.url=http://notification-service:8080/notify
